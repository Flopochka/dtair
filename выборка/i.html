<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSV Processor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
    <input type="file" id="csvFile" />
    <button onclick="processCSV()">Process CSV</button>
    <pre id="output"></pre>

    <script>
        function processCSV() {
            const fileInput = document.getElementById('csvFile');
            if (fileInput.files.length === 0) {
                alert('Please select a CSV file.');
                return;
            }

            const file = fileInput.files[0];
            Papa.parse(file, {
                delimiter: ";",
                header: true,
                skipEmptyLines: false,
                complete: function(results) {
                    const data = results.data;
                    const uniqueEntries = new Set();
                    const sqlQueries = [];
                    let previousRow = null;

                    data.forEach((row, index) => {
                        // Check if the current row is incomplete
                        if (!row.num_code) {
                            if (previousRow) {
                                // Merge the previous row with the current row
                                for (const key in row) {
                                    if (!row[key]) {
                                        row[key] = previousRow[key];
                                    }
                                }
                            }
                            previousRow = row;  // Save the row for the next iteration
                            return;
                        }
                        
                        // Cleaning up and formatting the data
                        const num_code = row.num_code;
                        const airline = row.airline;
                        const dest_from = row.from;
                        const dest_to = row.to;
                        const time_taken = row.time_taken.replace('h', ':').replace('m', ':00').replace(/\s+/g, '');
                        const stop = row.stop.trim();
                        const dep_time = row.dep_time;
                        const arr_time = row.arr_time;
                        const date = row.date;
                        const ch_code = row.ch_code;
                        const price = row.price.replace(',', '');

                        // Creating a unique key to ensure no duplicates
                        // const uniqueKey = `${num_code}-${airline}-${dest_from}-${dest_to}-${time_taken}-${date}-${ch_code}-${dep_time}-${arr_time}-${price}-${stop}`;
                        const uniqueKey = `${dest_from}`;
                        if (!uniqueEntries.has(uniqueKey)) {
                            uniqueEntries.add(uniqueKey);
                            const sql = `INSERT INTO destinations (id, title, img) VALUES (NULL, '${dest_from}', NULL);`;
                            sqlQueries.push(sql);
                        }

                        previousRow = null;  // Reset previous row
                    });

                    document.getElementById('output').textContent = sqlQueries.join('\n');
                }
            });
        }
    </script>
</body>
</html>